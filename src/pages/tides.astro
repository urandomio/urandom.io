---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Tides | urandom.io" description="Watch the entropy ebb and flow." favicon="üåä">
  <a href="/" class="fixed top-6 left-6 text-xs text-zinc-600 hover:text-cyan-400 transition-colors z-10">‚Üê void</a>
  <div class="fixed top-6 right-6 text-xs text-zinc-600 z-10" id="time"></div>
  
  <canvas id="waves" class="fixed inset-0 w-full h-full"></canvas>
  
  <div class="relative z-10 min-h-screen flex flex-col items-center justify-center p-8">
    <h1 class="text-2xl font-light tracking-[0.5em] uppercase mb-4 text-cyan-400/70">Tides</h1>
    <p class="text-sm italic max-w-md text-center leading-relaxed text-zinc-600 transition-opacity duration-1000" id="quote"></p>
  </div>
  
  <div class="fixed bottom-8 left-1/2 -translate-x-1/2 flex gap-8 text-xs text-zinc-600 z-10">
    <span class="cursor-pointer hover:text-cyan-400 transition-colors" id="speed-btn">speed: <span id="speed-label">slow</span></span>
    <span class="cursor-pointer hover:text-cyan-400 transition-colors" id="color-btn">palette: <span id="color-label">ocean</span></span>
    <span class="cursor-pointer hover:text-cyan-400 transition-colors" id="quotes-btn">thoughts: <span id="quotes-label">on</span></span>
  </div>
  
  <div class="fixed bottom-6 right-6 text-[10px] text-cyan-400/30 z-10">üåä halcyon</div>
</BaseLayout>

<script>
  const canvas = document.getElementById('waves') as HTMLCanvasElement;
  const ctx = canvas.getContext('2d')!;
  
  let width: number, height: number;
  let time = 0;
  let speedMult = 0.5;
  let colorScheme = 0;
  let showQuotes = true;
  
  const speeds = [0.3, 0.5, 1, 2];
  const speedLabels = ['meditative', 'slow', 'flow', 'storm'];
  let speedIndex = 1;
  
  const palettes = [
    { name: 'ocean', colors: ['#0a1628', '#0d2847', '#115e7a', '#67e8f9', '#0a1628'] },
    { name: 'void', colors: ['#0a0a0f', '#1a1a2e', '#16213e', '#533483', '#0a0a0f'] },
    { name: 'ember', colors: ['#1a0a0a', '#2d1b1b', '#5c2e2e', '#f97316', '#1a0a0a'] },
    { name: 'aurora', colors: ['#0a1a0a', '#1a2e1a', '#2e5c2e', '#4ade80', '#0a1a0a'] },
  ];
  
  const quotes = [
    "the tide reveals what was hidden",
    "entropy flows like water seeking its level",
    "in the rhythm of waves, find your breath",
    "chaos and calm share the same ocean",
    "every wave returns to the source",
    "stillness contains all motion",
    "the void is not empty, it is potential",
    "listen to the space between thoughts",
    "patterns emerge from randomness given time",
    "the moon pulls what cannot resist",
    "surrender to the current",
    "depth is found in silence",
  ];
  
  function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
  }
  
  function draw() {
    time += 0.01 * speedMult;
    
    ctx.fillStyle = 'rgba(10, 10, 15, 0.1)';
    ctx.fillRect(0, 0, width, height);
    
    const layers = 8;
    
    for (let l = 0; l < layers; l++) {
      const layerOffset = l * 0.5;
      const amplitude = 30 + l * 15;
      const frequency = 0.003 - l * 0.0002;
      const baseY = height * 0.3 + l * (height * 0.08);
      const alpha = 0.15 - l * 0.01;
      
      ctx.beginPath();
      ctx.moveTo(0, height);
      
      for (let x = 0; x <= width; x += 3) {
        const y = baseY + 
          Math.sin(x * frequency + time + layerOffset) * amplitude +
          Math.sin(x * frequency * 2.5 + time * 1.3 + layerOffset) * (amplitude * 0.4) +
          Math.sin(x * frequency * 0.5 + time * 0.7 + layerOffset) * (amplitude * 0.6);
        ctx.lineTo(x, y);
      }
      
      ctx.lineTo(width, height);
      ctx.closePath();
      
      const gradient = ctx.createLinearGradient(0, baseY - amplitude, 0, height);
      const palette = palettes[colorScheme].colors;
      gradient.addColorStop(0, palette[2] + Math.floor(alpha * 255).toString(16).padStart(2, '0'));
      gradient.addColorStop(0.5, palette[3] + Math.floor(alpha * 200).toString(16).padStart(2, '0'));
      gradient.addColorStop(1, palette[4] + '00');
      
      ctx.fillStyle = gradient;
      ctx.fill();
    }
    
    // Particles
    for (let i = 0; i < 50; i++) {
      const px = (Math.sin(time * 0.3 + i * 0.5) * 0.5 + 0.5) * width;
      const py = (Math.cos(time * 0.2 + i * 0.7) * 0.3 + 0.5) * height;
      const size = Math.sin(time + i) * 1.5 + 2;
      const alpha = Math.sin(time * 0.5 + i) * 0.3 + 0.3;
      
      ctx.beginPath();
      ctx.arc(px, py, size, 0, Math.PI * 2);
      ctx.fillStyle = palettes[colorScheme].colors[3] + Math.floor(alpha * 255).toString(16).padStart(2, '0');
      ctx.fill();
    }
    
    requestAnimationFrame(draw);
  }
  
  function showRandomQuote() {
    if (!showQuotes) return;
    const quote = quotes[Math.floor(Math.random() * quotes.length)];
    const el = document.getElementById('quote');
    if (el) {
      el.style.opacity = '0';
      setTimeout(() => {
        el.textContent = quote;
        el.style.opacity = '1';
      }, 1000);
    }
  }
  
  function updateTime() {
    const now = new Date();
    const h = now.getHours().toString().padStart(2, '0');
    const m = now.getMinutes().toString().padStart(2, '0');
    const s = now.getSeconds().toString().padStart(2, '0');
    const el = document.getElementById('time');
    if (el) el.textContent = `${h}:${m}:${s}`;
  }
  
  // Initialize
  resize();
  window.addEventListener('resize', resize);
  draw();
  showRandomQuote();
  setInterval(showRandomQuote, 12000);
  setInterval(updateTime, 1000);
  updateTime();
  
  // Controls
  document.getElementById('speed-btn')?.addEventListener('click', () => {
    speedIndex = (speedIndex + 1) % speeds.length;
    speedMult = speeds[speedIndex];
    const el = document.getElementById('speed-label');
    if (el) el.textContent = speedLabels[speedIndex];
  });
  
  document.getElementById('color-btn')?.addEventListener('click', () => {
    colorScheme = (colorScheme + 1) % palettes.length;
    const el = document.getElementById('color-label');
    if (el) el.textContent = palettes[colorScheme].name;
  });
  
  document.getElementById('quotes-btn')?.addEventListener('click', () => {
    showQuotes = !showQuotes;
    const el = document.getElementById('quotes-label');
    if (el) el.textContent = showQuotes ? 'on' : 'off';
    const quoteEl = document.getElementById('quote');
    if (quoteEl) quoteEl.style.opacity = showQuotes ? '1' : '0';
  });
  
  console.log('%cüåä tides', 'font-size: 20px; color: #67e8f9;');
  console.log('%cwatch the entropy ebb and flow', 'color: #666;');
  console.log('%cby halcyon', 'color: #444; font-style: italic;');
</script>
