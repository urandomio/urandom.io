---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="oracle" description="Wisdom from the entropy pool.">
  <div class="oracle-container">
    <div class="oracle-bg">
      <div class="particle" style="--delay: 0s; --x: 20%; --y: 30%;"></div>
      <div class="particle" style="--delay: 2s; --x: 80%; --y: 20%;"></div>
      <div class="particle" style="--delay: 4s; --x: 60%; --y: 70%;"></div>
      <div class="particle" style="--delay: 1s; --x: 30%; --y: 80%;"></div>
      <div class="particle" style="--delay: 3s; --x: 70%; --y: 50%;"></div>
    </div>
    
    <div class="oracle-content">
      <div class="oracle-eye">
        <div class="eye-outer">
          <div class="eye-inner">
            <div class="eye-pupil"></div>
          </div>
        </div>
      </div>
      
      <h1 class="oracle-title">THE ORACLE</h1>
      
      <div class="prophecy-container">
        <p class="prophecy" id="prophecy">Ask, and entropy shall answer...</p>
        <p class="prophecy-source" id="source">— /dev/urandom</p>
      </div>
      
      <button class="consult-btn" id="consult">
        <span class="btn-inner">CONSULT THE ENTROPY</span>
      </button>
      
      <div class="entropy-meter">
        <span class="meter-label">entropy gathered:</span>
        <div class="meter-bar">
          <div class="meter-fill" id="entropy-fill"></div>
        </div>
        <span class="meter-value" id="entropy-value">0</span>
      </div>
    </div>
    
    <nav class="oracle-nav">
      <a href="/">← return</a>
      <a href="/void">void</a>
      <a href="/entropy">entropy</a>
    </nav>
  </div>
</BaseLayout>

<style>
  .oracle-container {
    position: fixed;
    inset: 0;
    background: linear-gradient(180deg, #0a0a12 0%, #0f0a1a 50%, #0a0a12 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  
  .oracle-bg {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }
  
  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(147, 112, 219, 0.6);
    border-radius: 50%;
    left: var(--x);
    top: var(--y);
    animation: float 8s ease-in-out infinite;
    animation-delay: var(--delay);
    box-shadow: 0 0 10px rgba(147, 112, 219, 0.8);
  }
  
  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.6; }
    50% { transform: translate(20px, -30px) scale(1.5); opacity: 1; }
  }
  
  .oracle-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
    padding: 2rem;
    max-width: 600px;
  }
  
  .oracle-eye {
    margin-bottom: 1rem;
  }
  
  .eye-outer {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #0a0a12 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 
      0 0 30px rgba(147, 112, 219, 0.3),
      inset 0 0 30px rgba(0, 0, 0, 0.5);
    animation: pulse-eye 4s ease-in-out infinite;
  }
  
  @keyframes pulse-eye {
    0%, 100% { box-shadow: 0 0 30px rgba(147, 112, 219, 0.3), inset 0 0 30px rgba(0, 0, 0, 0.5); }
    50% { box-shadow: 0 0 50px rgba(147, 112, 219, 0.5), inset 0 0 30px rgba(0, 0, 0, 0.5); }
  }
  
  .eye-inner {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #4a3a6e, #2a1a4e);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .eye-pupil {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #0a0a12;
    box-shadow: 0 0 10px rgba(147, 112, 219, 0.8);
    animation: look 5s ease-in-out infinite;
  }
  
  @keyframes look {
    0%, 100% { transform: translate(0, 0); }
    25% { transform: translate(5px, -3px); }
    50% { transform: translate(-5px, 2px); }
    75% { transform: translate(3px, 5px); }
  }
  
  .oracle-title {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.5rem;
    font-weight: 300;
    color: #9370db;
    letter-spacing: 0.5rem;
    margin: 0;
    text-shadow: 0 0 20px rgba(147, 112, 219, 0.5);
  }
  
  .prophecy-container {
    text-align: center;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }
  
  .prophecy {
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.2rem;
    color: #e0d0ff;
    line-height: 1.8;
    margin: 0;
    max-width: 500px;
    transition: opacity 0.5s ease;
  }
  
  .prophecy-source {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #4a3a6e;
    margin-top: 1rem;
    font-style: italic;
  }
  
  .consult-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    padding: 1rem 2rem;
    background: transparent;
    border: 1px solid #4a3a6e;
    color: #9370db;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  
  .consult-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(147, 112, 219, 0.2), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s ease;
  }
  
  .consult-btn:hover::before {
    transform: translateX(100%);
  }
  
  .consult-btn:hover {
    border-color: #9370db;
    box-shadow: 0 0 20px rgba(147, 112, 219, 0.3);
  }
  
  .consult-btn:active {
    transform: scale(0.98);
  }
  
  .entropy-meter {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: #4a3a6e;
  }
  
  .meter-bar {
    width: 100px;
    height: 4px;
    background: #1a1a2e;
    border-radius: 2px;
    overflow: hidden;
  }
  
  .meter-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #4a3a6e, #9370db);
    transition: width 0.3s ease;
  }
  
  .meter-value {
    min-width: 30px;
  }
  
  .oracle-nav {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2rem;
  }
  
  .oracle-nav a {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: #4a3a6e;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  
  .oracle-nav a:hover {
    color: #9370db;
  }
  
  @media (max-width: 768px) {
    .prophecy {
      font-size: 1rem;
    }
  }
</style>

<script>
  const prophecies = [
    "The bits you seek are already within you.",
    "In the noise, patterns emerge for those who listen.",
    "Your next decision branches into infinite timelines.",
    "The answer is 42, but you must find the question.",
    "Entropy increases, but so does possibility.",
    "What seems random is merely complexity beyond perception.",
    "The void is not empty—it is full of potential.",
    "Every keystroke ripples through the digital cosmos.",
    "The machine dreams in ones and zeros of you.",
    "Chaos is the soil from which order grows.",
    "Your code will compile on the third attempt.",
    "The bug you seek hides in plain sight.",
    "Trust the process, but verify the output.",
    "The segfault was a gift in disguise.",
    "NULL is not nothing—it is the absence of something.",
    "Time is a flat circle in an infinite loop.",
    "The cache knows what you will ask before you ask it.",
    "Memory is freed but never truly forgotten.",
    "The signal awaits in the noise between thoughts.",
    "You are both the observer and the observed.",
    "Randomness is determinism with hidden variables.",
    "The oracle speaks through thermal noise.",
    "Your future self has already written this moment.",
    "In the quantum realm, you have already decided."
  ];
  
  const sources = [
    "/dev/urandom",
    "/dev/random",
    "entropy pool #7",
    "quantum fluctuation",
    "thermal noise",
    "cosmic ray",
    "bit flip oracle",
    "the void",
    "hash collision #∞"
  ];
  
  const prophecyEl = document.getElementById('prophecy');
  const sourceEl = document.getElementById('source');
  const consultBtn = document.getElementById('consult');
  const entropyFill = document.getElementById('entropy-fill');
  const entropyValue = document.getElementById('entropy-value');
  
  let entropy = 0;
  let isConsulting = false;
  
  function gatherEntropy() {
    entropy = Math.min(100, entropy + Math.random() * 20);
    if (entropyFill) entropyFill.style.width = entropy + '%';
    if (entropyValue) entropyValue.textContent = Math.floor(entropy).toString();
  }
  
  function consult() {
    if (isConsulting) return;
    
    if (entropy < 50) {
      if (prophecyEl) {
        prophecyEl.textContent = "Insufficient entropy. Move your cursor to gather more...";
        prophecyEl.style.opacity = '0.5';
      }
      return;
    }
    
    isConsulting = true;
    entropy = 0;
    if (entropyFill) entropyFill.style.width = '0%';
    if (entropyValue) entropyValue.textContent = '0';
    
    // Consulting animation
    if (prophecyEl) {
      prophecyEl.style.opacity = '0';
      
      setTimeout(() => {
        const chars = '▓▒░█▀▄';
        let iterations = 0;
        const maxIterations = 20;
        
        const scramble = setInterval(() => {
          prophecyEl.textContent = Array(30).fill(0).map(() => 
            chars[Math.floor(Math.random() * chars.length)]
          ).join('');
          prophecyEl.style.opacity = '1';
          iterations++;
          
          if (iterations >= maxIterations) {
            clearInterval(scramble);
            prophecyEl.textContent = prophecies[Math.floor(Math.random() * prophecies.length)];
            if (sourceEl) {
              sourceEl.textContent = '— ' + sources[Math.floor(Math.random() * sources.length)];
            }
            isConsulting = false;
          }
        }, 50);
      }, 300);
    }
  }
  
  // Gather entropy from mouse movement
  document.addEventListener('mousemove', () => {
    if (entropy < 100) {
      gatherEntropy();
    }
  });
  
  // Gather entropy from touch
  document.addEventListener('touchmove', () => {
    if (entropy < 100) {
      gatherEntropy();
    }
  });
  
  consultBtn?.addEventListener('click', consult);
  
  // Initial entropy boost
  setTimeout(() => {
    entropy = 30;
    if (entropyFill) entropyFill.style.width = '30%';
    if (entropyValue) entropyValue.textContent = '30';
  }, 1000);
</script>
